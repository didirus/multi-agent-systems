__includes["update-intentions.nls" "perform-actions.nls" "init-buses.nls" "protocols.nls" "procedures.nls" "messaging.nls"]

extensions[table]

globals [graph]

buses-own [
  ; STATIC READ-ONLY
  bus_id          ; The ID of a given agent (bus). Each agent has a unique ID.
  bus_type        ; The type of a given agent (bus). 1 means "small", 2 means "medium" and 3 means "large".
  
  ; DYNAMIC READ-ONLY
  inbox           ; List containing all the incoming messages (a given message is a list like this [tick sender message]).
  bus_passengers  ; List containing all the passengers that the agent (bus) is currently carrying (represented as a list like this [passenger_id bus_stop]).
  previous_stop   ; ID of the last bus stop that the agent (bus) visited (-1 means that the agent has not visited any bus stop yet).
  current_stop    ; ID of the bus stop where the agent (bus) currently is (-1 means that the agent is not at any bus stop).
  next_stop       ; ID of the bus stop the agent (bus) is traveling to (-1 means that the agent is not travelling to any bus stop).
  
  ; CONFIGS
  debug_traffic
  debug_messages
  debug_purchases
  
  ; CONSTANTS
  tracks
  junctions
  
  ; VARIABLES
  desire
  intention

  track
  track_index
  
  overloaded:UNINITIATED
  overloaded:ABOUT_TO_BUY
  overloaded:INSTRUCTING
  overloaded:COLLIDED
  overloaded:WAKING_UP
  
  overloaded.want_to_buy
  overloaded.do_not_buy
  overloaded.we_collided
  overloaded.come_to_my_track

  overloaded/state
  overloaded/timeout
  overloaded/timer
  overloaded/dice
  overloaded/newest_bus
]

to execute-actions
  set desire determine-desire?
  update-intentions 
  perform-actions
  check-inbox
  lead-protocols

  if count buses = 1 [
    add-bus 1
    add-bus 1
  ]  
end

to-report determine-desire?
  ifelse waiting-passengers? and not (overloaded/state = overloaded:WAKING_UP)
    [report "routine"]
    [report "idle"]
end