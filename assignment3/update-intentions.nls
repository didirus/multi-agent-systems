to update-intentions
  run (word "follow-" desire)
end


to follow-routine
  if not at-stop? [set intention "drive" stop]
  if any bus_passengers (task wants-to-leave) [set intention "drop_off" stop]
  if not overloaded? and any get-passengers-at-stop current_stop (task wants-to-enter) [set intention "pick_up" stop]
  set intention "drive"
end

to-report wants-to-leave [passenger]
  report (destination-of passenger = current_stop) or (at-junction? and not on-my-track destination-of passenger)
end

to-report wants-to-enter [passenger]
  report not at-junction? or on-my-track destination-of passenger
end

to-report destination-of [passenger]
  report item 1 passenger
end

to-report id-of [passenger]
  report item 0 passenger
end

to-report any [collection predicate]
  report not empty? collection and reduce [?1 or (runresult predicate ?2)] (fput false collection)
end

to follow-idle
  set intention "stop"
end